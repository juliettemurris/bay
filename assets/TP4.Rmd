---
title: "TP4 : Importance des variables"
author: "Juliette Murris"
date: "Janvier 2024"
output: html_document
---

Dans ce TP nous travaillerons sur la base de donn√©es _lung_ disponible dans R. Les TP 1 et 2 portait d√©j√† sur cette base. Vous pouvez vous y reporter pour la description des variables.
L'objectif de ce TP est de se familliariser avec la notion d'importance des variables sur un probl√®me de classification : pr√©diction du d√©c√®s chez les patients atteints d'un cancer du poumon.

## Pr√©requis : 

T√©l√©chargement des packages n√©cessaires.

```{r, echo=TRUE,message=FALSE,warning=FALSE}
library(survival)
library(dplyr)
library(pROC)
library(ModelMetrics)
library(iml)
library(mlr)
library(packHV)
library(forestplot)
```

Chargement des donn√©es : 

```{r}
  data(lung)
```

Nous avons vu dans les TP pr√©c√©dent que : 
  - la base lung contient des valeurs manquantes -> on supprime les patients avec au moins une donn√©e manquante
  - la variable codant le d√©c√®s est code 1/2 -> on recode le d√©c√®s en 0/1
  
  
```{r}
  lung = na.omit(lung)
  Booleen = lung$status == 2
  lung$status = 1*Booleen
  lung$status = as.factor(as.character(lung$status))
  lung$sex = as.factor(as.character(lung$sex))
```


Pour appliquer les diff√©rents mod√®les, on scinde notre base en deux : 
  - une base d'entrainement 
  - une base de test


```{r}
  set.seed(10) #On fixe une "graine" de simulation pour tous avoir le m√™me tirage al√©atoire
  ind_test = sample(1:dim(lung)[1],replace = FALSE, dim(lung)[1]*0.2)
  Training_set = lung[-ind_test,]
  Test_set = lung[ind_test,]
```


## I. Illustration de l'importance des variables "√† la main" avec un mod√®le de r√©gression logistic 


 <span style='color: #a13203; font-weight: 600;'>üí¨ Question 1 </span> R√©aliser un mod√®le logistic avec pour covariables les variables continues : _age_, _ph.ecog_, _ph.karno_, _pat.karno_, _meal.cal_, _wt.loss_

```{r,include=TRUE}
# R√©ponse :
# 
# 
# 
#
#
#
#
#
#
```


 <span style='color: #a13203; font-weight: 600;'>üí¨ Question 2 </span> R√©aliser un forestplot pour observer les effets des variables via les Odds Ratio 


```{r,include=TRUE}
# R√©ponse :
# 
# 
# 
#
#
#
#
#
#
```

 <span style='color: #a13203; font-weight: 600;'>üí¨ Question 3 </span>  Une autre option pour √©valuer l'impact des variables est d'√©tudier les coefficients standardis√©s

Pour rappel les coefficient standardis√© correspondent aux param√®tres estim√©s si nous avions lanc√© la r√©gression sur les donn√©es centr√©es et r√©duites.

```{r,include=TRUE}
# R√©ponse :
# 
# 
# 
#
#
#
#
#
#
```




 <span style='color: #a13203; font-weight: 600;'>üí¨ Question 4 </span>  R√©cup√©ration du cut-off (cf TP2)

```{r,include=TRUE}
# R√©ponse :
# 
# 
# 
#
#
#
#
#
#
```



 <span style='color: #a13203; font-weight: 600;'>üí¨ Question 4 </span>  Programmation d'une fonction pour le calcul de l'erreur de pr√©diction et la tester sur le mod√®le pr√©c√©dent

On d√©finit l'erreur de pr√©diction comme √©tant : 
$$ \frac{\text{Nombre de patients pour lesquels on a fait une erreur de pr√©diction}}{\text{Nombre total de patients}} $$

```{r,include=TRUE}
# R√©ponse :
# 
# 
# 
#
#
#
#
#
#
```




 <span style='color: #a13203; font-weight: 600;'>üí¨ Question 5 </span>  Interpr√©ter la fonction suivante et tester l√† sur votre jeu de donn√©es

```{r,include=TRUE}
# R√©ponse :
# 
# 
# 
#
#
#
#
#
#
```


 <span style='color: #a13203; font-weight: 600;'>üí¨ Question 6 </span>  R√©it√©rer 200 fois la fonction pr√©c√©dente et regarder le r√©sultat en terme de moyenne et m√©diane

```{r,include=TRUE}
# R√©ponse :
# 
# 
# 
#
#
#
#
#
#
```




 <span style='color: #a13203; font-weight: 600;'>üí¨ Question 7 </span>  Repr√©senter graphiquement l'effet des variables 

```{r,include=TRUE}
# R√©ponse :
# 
# 
# 
#
#
#
#
#
#
```





## II. Calcul de l'influence des variable avec le package _iml_


 <span style='color: #a13203; font-weight: 600;'>üí¨ Question 1 </span>  R√©aliser un mod√®le logistic avec pour covariables les variables continues : _age_, _ph.ecog_, _ph.karno_, _pat.karno_, _meal.cal_, _wt.loss_ avec le package _mlr_ 

R√©aliser les √©tapes suivantes:
  - Regarder comment fonctionne le package mlr
  - D√©finisser et appliquer un classifieur bas√© sur une r√©gression logistique
  - R√©aliser une pr√©diction sur les donn√©es d'entrainement
  - D√©finissez le cutoff optimal


```{r,include=TRUE}
# R√©ponse :
# 
# 
# 
#
#
#
#
#
#
```

 <span style='color: #a13203; font-weight: 600;'>üí¨ Question 2 </span>  Evaluer l'importance des variables √† partir de la fonction _FeatureImp_, expliciter ce √† quoi correspond la perte _"ce"_ 

```{r,include=TRUE}
# R√©ponse :
# 
# 
# 
#
#
#
#
#
#
```



## III. R√©aliser d'autres mod√®les de classification et √©valuer l'importance des variables



```{r,include=TRUE}
# R√©ponse :
# 
# 
# 
#
#
#
#
#
#
```





